{"version":3,"sources":["assets\\ShootFish\\ShootFishScript\\ShootFish.Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Utils from \"../../Lobby/LobbyScript/Script/common/Utils\";\nimport Play from \"./ShootFish.Play\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Bullet extends cc.Component {\n\n    @property(cc.Node)\n    bullet: cc.Node = null;\n    @property(cc.Node)\n    fishNet: cc.Node = null;\n\n    public id: string = \"\";\n    public targetFishId = -1;\n\n    private readonly worldSize: cc.Size = cc.size(1280, 720);\n    private readonly exploreDuration: number = 0.8;\n\n    private vX = 0;\n    private vY = 0;\n    private collisionCount = 4;\n    isExplored = false;\n    isExploring = false;\n    private curExplore = 0;\n    private circle: SAT.Circle = null;\n\n    public run() {\n        let speed = Number(Play.SERVER_CONFIG['BulletSpeed']);\n        if(isNaN(speed) || speed == 0) speed = 1400;\n        let v = Utils.degreesToVec2(this.node.angle);\n        this.vX = v.x * speed;\n        this.vY = v.y * speed;\n        this.collisionCount = 4;\n        this.isExplored = false;\n        this.isExploring = false;\n        this.bullet.active = true;\n        this.fishNet.active = false;\n\n        this.circle = new SAT.Circle(new SAT.Vector(this.node.position.x, this.node.position.y), Number(Play.SERVER_CONFIG['BulletRadius']));\n    }\n\n    public updateRealTime(dt: number) {\n        if (this.isExplored) return;\n        if (this.isExploring) {\n            this.curExplore -= dt;\n            if (this.curExplore <= 0) {\n                this.isExplored = true;\n                this.node.active = false;\n            }\n            return;\n        }\n        var newPos = this.node.position;\n        newPos.x += this.vX * dt;\n        newPos.y += this.vY * dt;\n        this.node.position = newPos;\n\n        if (Math.abs(newPos.x) > this.worldSize.width / 2) {\n            this.vX *= -1;\n\n            var angle = Math.atan2(this.vY, this.vX) * Utils.Rad2Deg;\n            this.node.angle = angle;\n\n            newPos.x = (newPos.x < 0 ? -1 : 1) * this.worldSize.width / 2;\n            this.node.position = newPos;\n\n            this.collisionCount--;\n        } else if (Math.abs(newPos.y) > this.worldSize.height / 2) {\n            this.vY *= -1;\n\n            var angle = Math.atan2(this.vY, this.vX) * Utils.Rad2Deg;\n            this.node.angle = angle;\n\n            newPos.y = (newPos.y < 0 ? -1 : 1) * this.worldSize.height / 2;\n            this.node.position = newPos;\n\n            this.collisionCount--;\n        }\n\n        this.circle.pos = new SAT.Vector(this.node.position.x, this.node.position.y);\n\n        if (this.collisionCount < 0) {\n            this.node.active = false;\n        }\n    }\n\n    public explore() {\n        this.isExploring = true;\n        this.curExplore = this.exploreDuration;\n        this.bullet.active = false;\n        this.fishNet.active = true;\n        this.fishNet.opacity = 0;\n        this.fishNet.angle = 0;\n        this.fishNet.scale = 0;\n\n        this.fishNet.stopAllActions();\n\n        this.fishNet.runAction(cc.spawn(\n            cc.sequence(cc.scaleTo(0.3, 1.1), cc.delayTime(0.07), cc.scaleTo(0.3, 1)),\n            cc.fadeIn(0.1),\n            cc.sequence(cc.delayTime(0.25), cc.rotateTo(0.5, 35)),\n            cc.sequence(cc.delayTime(0.4), cc.fadeOut(0.3))\n        ));\n    }\n\n    public getCircle(): SAT.Circle {\n        return this.circle;\n    }\n}\n"]}