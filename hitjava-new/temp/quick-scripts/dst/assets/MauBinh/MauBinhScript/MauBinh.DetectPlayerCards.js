
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/MauBinh/MauBinhScript/MauBinh.DetectPlayerCards.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '0895cqkOZ1FQ6FEXmsgpXkF', 'MauBinh.DetectPlayerCards');
// MauBinh/MauBinhScript/MauBinh.DetectPlayerCards.ts

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.maubinh = void 0;
var MauBinh_Cmd_1 = require("./MauBinh.Cmd");
var MauBinh_Card_1 = require("./MauBinh.Card");
var MauBinh_DetectGroupCards_1 = require("./MauBinh.DetectGroupCards");
var maubinh;
(function (maubinh) {
    var DetectPlayerCards = /** @class */ (function () {
        function DetectPlayerCards() {
            this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_BINH_THUONG;
            this.chiDau = new MauBinh_DetectGroupCards_1.default;
            this.chiGiua = new MauBinh_DetectGroupCards_1.default;
            this.chiCuoi = new MauBinh_DetectGroupCards_1.default;
        }
        DetectPlayerCards.prototype.initCard = function (a) {
            //  cc.log("DetectPlayerCard initCard a : ", a);
            //  cc.log("DetectPlayerCard initCard chiDau : ", this.chiDau);
            //  cc.log("DetectPlayerCard initCard chiGiua : ", this.chiGiua);
            //  cc.log("DetectPlayerCard initCard chiCuoi : ", this.chiCuoi);
            for (var c = 10; c < 13; c++)
                this.chiCuoi.addCard(new MauBinh_Card_1.default(a[c - 10], null)); // 0, 1, 2
            for (c = 5; c < 10; c++)
                this.chiGiua.addCard(new MauBinh_Card_1.default(a[c - 2], null)); // 3, 4, 5, 6, 7
            for (c = 0; c < 5; c++)
                this.chiDau.addCard(new MauBinh_Card_1.default(a[c + 8], null)); // 8, 9, 10, 11, 12
        };
        DetectPlayerCards.prototype.getPlayerCardsInfo = function (isTinhAce) {
            var kind_01 = this.chiDau.getGroupCardsInfo();
            //  cc.log("DetectPlayerCard getPlayerCardsInfo chiDau : ", kind_01);
            var kind_02 = this.chiGiua.getGroupCardsInfo();
            //  cc.log("DetectPlayerCard getPlayerCardsInfo chiGiua : ", kind_02);
            var kind_03 = this.chiCuoi.getGroupCardsInfo();
            //  cc.log("DetectPlayerCard getPlayerCardsInfo chiCuoi : ", kind_03);
            this.isSanhRong() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_SANH_RONG
                : isTinhAce && this.isMuoiBaCayDongMau() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_MUOI_BA_CAY_DONG_MAU
                    : isTinhAce && this.isMuoiHaiCayDongMau() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_MUOI_HAI_CAY_DONG_MAU
                        : this.isBaCaiThung() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_BA_CAI_THUNG
                            : this.isBaCaiSanh() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_BA_CAI_SANH
                                : this.isLucPheBon() ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_LUC_PHE_BON
                                    : this.isBinhLung(isTinhAce) ? this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_BINH_LUNG
                                        : this.maubinhType = MauBinh_Cmd_1.default.Code.TYPE_BINH_THUONG;
            return {
                cardType: this.maubinhType,
                chiDau: kind_01,
                chiGiua: kind_02,
                chiCuoi: kind_03
            };
        };
        DetectPlayerCards.prototype.addCardToChiDau = function (a) {
            this.chiDau.addCard(a);
        };
        DetectPlayerCards.prototype.addCardToChiGiua = function (a) {
            this.chiGiua.addCard(a);
        };
        DetectPlayerCards.prototype.addCardToChiCuoi = function (a) {
            this.chiCuoi.addCard(a);
        };
        DetectPlayerCards.prototype.getChi = function (a) {
            switch (a) {
                case 1:
                    return this.chiDau;
                case 2:
                    return this.chiGiua;
                case 3:
                    return this.chiCuoi;
            }
        };
        DetectPlayerCards.prototype.getGroupCardContainsIndex = function (a) {
            return 0 <= a && 5 > a ? this.chiDau : 10 > a ? this.chiGiua : 13 > a ? this.chiCuoi : null;
        };
        DetectPlayerCards.prototype.getAllCards = function () {
            var a = [], a = a.concat(this.chiDau.cardList), a = a.concat(this.chiGiua.cardList);
            return a = a.concat(this.chiCuoi.cardList);
        };
        DetectPlayerCards.prototype.swapCard = function (a, b) {
            var c = a.id;
            a.id = b.id;
            b.id = c;
        };
        // Types
        DetectPlayerCards.prototype.isSanhRong = function () {
            for (var a = this.getSortedCardListFromList(this.getAllCards()), b = 0, c = 1, d = 0; d < a.length; d++)
                c++, a[d].getNumber() == c && b++;
            return 13 == b;
        };
        DetectPlayerCards.prototype.isMuoiBaCayDongMau = function () {
            for (var a = this.getAllCards(), b = 0, c = 0, d = 0; d < a.length; d++)
                a[d].getColor() == MauBinh_Cmd_1.default.Code.BLACK ? b++ : c++;
            return 13 == b || 13 == c;
        };
        DetectPlayerCards.prototype.isMuoiHaiCayDongMau = function () {
            for (var a = this.getAllCards(), b = 0, c = 0, d = 0; d < a.length; d++)
                a[d].getColor() == MauBinh_Cmd_1.default.Code.BLACK ? b++ : c++;
            return 12 == b || 12 == c;
        };
        DetectPlayerCards.prototype.isBaCaiThung = function () {
            if (!(this.chiDau.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG_PHA_SANH && this.chiDau.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG || this.chiGiua.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG_PHA_SANH && this.chiGiua.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG)) {
                var a = this.chiCuoi.cardList;
                if (a[0].getSuit() == a[1].getSuit() && a[1].getSuit() == a[2].getSuit())
                    return !0;
            }
            return !1;
        };
        DetectPlayerCards.prototype.isBaCaiSanh = function () {
            if (!(this.chiDau.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG_PHA_SANH && this.chiDau.groupKind != MauBinh_Cmd_1.default.Code.GROUP_SANH || this.chiGiua.groupKind != MauBinh_Cmd_1.default.Code.GROUP_THUNG_PHA_SANH && this.chiGiua.groupKind != MauBinh_Cmd_1.default.Code.GROUP_SANH)) {
                var a = this.getSortedCardListFromList(this.chiCuoi.cardList);
                if (a[0].getNumber() + 1 == a[1].getNumber() && a[1].getNumber() + 1 == a[2].getNumber() || 2 == a[0].getNumber() &&
                    3 == a[1].getNumber() && 14 == a[2].getNumber())
                    return !0;
            }
            return !1;
        };
        DetectPlayerCards.prototype.haveSauDoi = function () {
            for (var a = this.getSortedCardListFromList(this.getAllCards()), b = 0, c = 0; c < a.length;)
                c + 1 < a.length && a[c + 1].getNumber() == a[c].getNumber() && (b++, c++), c++;
            return 6 == b;
        };
        DetectPlayerCards.prototype.isLucPheBon = function () {
            return this.haveSauDoi() && this.chiDau.groupKind == MauBinh_Cmd_1.default.Code.GROUP_THU && this.chiGiua.groupKind == MauBinh_Cmd_1.default.Code.GROUP_THU && this.chiCuoi.groupKind == MauBinh_Cmd_1.default.Code.GROUP_MOT_DOI ? !0 : !1;
        };
        DetectPlayerCards.prototype.isBinhLung = function (a) {
            return 0 > this.compareChi(this.chiDau, this.chiGiua, a) || 0 > this.compareChi(this.chiGiua, this.chiCuoi, a) ? !0 : !1;
        };
        DetectPlayerCards.prototype.getSortedCardListFromList = function (a) {
            for (var b = [], c = 0; c < a.length; c++)
                b.push(a[c]);
            for (c = 0; c < b.length - 1; c++)
                for (a = c + 1; a < b.length; a++)
                    if (b[c].getId() > b[a].getId()) {
                        var d = b[c];
                        b[c] = b[a];
                        b[a] = d;
                    }
            return b;
        };
        DetectPlayerCards.prototype.compareChi = function (a, b, c) {
            if (a.groupKind > b.groupKind)
                return -1;
            if (a.groupKind < b.groupKind)
                return 1;
            if (c) {
                var d = a.getGroupKindLevel(c);
                c = b.getGroupKindLevel(c);
                if (d > c)
                    return -1;
                if (d < c)
                    return 1;
            }
            for (d = 0; d < a.valueList.length; d++) {
                if (a.valueList[d] > b.valueList[d])
                    return 1;
                if (a.valueList[d] < b.valueList[d])
                    return -1;
            }
            return 0;
        };
        return DetectPlayerCards;
    }());
    maubinh.DetectPlayerCards = DetectPlayerCards;
})(maubinh = exports.maubinh || (exports.maubinh = {}));
exports.default = maubinh.DetectPlayerCards;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcTWF1QmluaFxcTWF1QmluaFNjcmlwdFxcTWF1QmluaC5EZXRlY3RQbGF5ZXJDYXJkcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2Q0FBZ0M7QUFDaEMsK0NBQXlDO0FBQ3pDLHVFQUFpRTtBQUVqRSxJQUFpQixPQUFPLENBK0p2QjtBQS9KRCxXQUFpQixPQUFPO0lBQ3BCO1FBQUE7WUFDSSxnQkFBVyxHQUFHLHFCQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1lBQ3hDLFdBQU0sR0FBRyxJQUFJLGtDQUF1QixDQUFDO1lBQ3JDLFlBQU8sR0FBRyxJQUFJLGtDQUF1QixDQUFDO1lBQ3RDLFlBQU8sR0FBRyxJQUFJLGtDQUF1QixDQUFDO1FBeUoxQyxDQUFDO1FBdkpHLG9DQUFRLEdBQVIsVUFBUyxDQUFDO1lBQ04sZ0RBQWdEO1lBQ2hELCtEQUErRDtZQUMvRCxpRUFBaUU7WUFDakUsaUVBQWlFO1lBQ2pFLEtBQUssSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFO2dCQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksc0JBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBRSxVQUFVO1lBQ2pHLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRTtnQkFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLHNCQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUksZ0JBQWdCO1lBQ25HLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFBRSxJQUFJLENBQUMsTUFB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QUFBO0FBQ0wsQ0FBQyxFQS9KZ0IsT0FBTyxHQUFQLGVBQU8sS0FBUCxlQUFPLFFBK0p2QjtBQUVELGtCQUFlLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyIsImZpbGUiOiIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDbWQgZnJvbSAnLi9NYXVCaW5oLkNtZCc7XG5pbXBvcnQgTWF1QmluaENhcmQgZnJvbSAnLi9NYXVCaW5oLkNhcmQnO1xuaW1wb3J0IE1hdUJpbmhEZXRlY3RHcm91cENhcmRzIGZyb20gXCIuL01hdUJpbmguRGV0ZWN0R3JvdXBDYXJkc1wiO1xuXG5leHBvcnQgbmFtZXNwYWNlIG1hdWJpbmgge1xuICAgIGV4cG9ydCBjbGFzcyBEZXRlY3RQbGF5ZXJDYXJkcyB7XG4gICAgICAgIG1hdWJpbmhUeXBlID0gQ21kLkNvZGUuVFlQRV9CSU5IX1RIVU9ORztcbiAgICAgICAgY2hpRGF1ID0gbmV3IE1hdUJpbmhEZXRlY3RHcm91cENhcmRzO1xuICAgICAgICBjaGlHaXVhID0gbmV3IE1hdUJpbmhEZXRlY3RHcm91cENhcmRzO1xuICAgICAgICBjaGlDdW9pID0gbmV3IE1hdUJpbmhEZXRlY3RHcm91cENhcmRzO1xuXG4gICAgICAgIGluaXRDYXJkKGEpIHtcbiAgICAgICAgICAgIC8vICBjYy5sb2coXCJEZXRlY3RQbGF5ZXJDYXJkIGluaXRDYXJkIGEgOiBcIiwgYSk7XG4gICAgICAgICAgICAvLyAgY2MubG9nKFwiRGV0ZWN0UGxheWVyQ2FyZCBpbml0Q2FyZCBjaGlEYXUgOiBcIiwgdGhpcy5jaGlEYXUpO1xuICAgICAgICAgICAgLy8gIGNjLmxvZyhcIkRldGVjdFBsYXllckNhcmQgaW5pdENhcmQgY2hpR2l1YSA6IFwiLCB0aGlzLmNoaUdpdWEpO1xuICAgICAgICAgICAgLy8gIGNjLmxvZyhcIkRldGVjdFBsYXllckNhcmQgaW5pdENhcmQgY2hpQ3VvaSA6IFwiLCB0aGlzLmNoaUN1b2kpO1xuICAgICAgICAgICAgZm9yICh2YXIgYyA9IDEwOyBjIDwgMTM7IGMrKykgdGhpcy5jaGlDdW9pLmFkZENhcmQobmV3IE1hdUJpbmhDYXJkKGFbYyAtIDEwXSwgbnVsbCkpOyAgLy8gMCwgMSwgMlxuICAgICAgICAgICAgZm9yIChjID0gNTsgYyA8IDEwOyBjKyspIHRoaXMuY2hpR2l1YS5hZGRDYXJkKG5ldyBNYXVCaW5oQ2FyZChhW2MgLSAyXSwgbnVsbCkpOyAgICAvLyAzLCA0LCA1LCA2LCA3XG4gICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgNTsgYysrKSB0aGlzLmNoaURhdS5hZGRDYXJkKG5ldyBNYXVCaW5oQ2FyZChhW2MgKyA4XSwgbnVsbCkpOyAgLy8gOCwgOSwgMTAsIDExLCAxMlxuICAgICAgICB9XG5cbiAgICAgICAgZ2V0UGxheWVyQ2FyZHNJbmZvKGlzVGluaEFjZSkge1xuICAgICAgICAgICAgbGV0IGtpbmRfMDEgPSB0aGlzLmNoaURhdS5nZXRHcm91cENhcmRzSW5mbygpO1xuICAgICAgICAgICAgLy8gIGNjLmxvZyhcIkRldGVjdFBsYXllckNhcmQgZ2V0UGxheWVyQ2FyZHNJbmZvIGNoaURhdSA6IFwiLCBraW5kXzAxKTtcbiAgICAgICAgICAgIGxldCBraW5kXzAyID0gdGhpcy5jaGlHaXVhLmdldEdyb3VwQ2FyZHNJbmZvKCk7XG4gICAgICAgICAgICAvLyAgY2MubG9nKFwiRGV0ZWN0UGxheWVyQ2FyZCBnZXRQbGF5ZXJDYXJkc0luZm8gY2hpR2l1YSA6IFwiLCBraW5kXzAyKTtcbiAgICAgICAgICAgIGxldCBraW5kXzAzID0gdGhpcy5jaGlDdW9pLmdldEdyb3VwQ2FyZHNJbmZvKCk7XG4gICAgICAgICAgICAvLyAgY2MubG9nKFwiRGV0ZWN0UGxheWVyQ2FyZCBnZXRQbGF5ZXJDYXJkc0luZm8gY2hpQ3VvaSA6IFwiLCBraW5kXzAzKTtcblxuICAgICAgICAgICAgdGhpcy5pc1NhbmhSb25nKCkgPyB0aGlzLm1hdWJpbmhUeXBlID0gQ21kLkNvZGUuVFlQRV9TQU5IX1JPTkdcbiAgICAgICAgICAgICAgICA6IGlzVGluaEFjZSAmJiB0aGlzLmlzTXVvaUJhQ2F5RG9uZ01hdSgpID8gdGhpcy5tYXViaW5oVHlwZSA9IENtZC5Db2RlLlRZUEVfTVVPSV9CQV9DQVlfRE9OR19NQVVcbiAgICAgICAgICAgICAgICAgICAgOiBpc1RpbmhBY2UgJiYgdGhpcy5pc011b2lIYWlDYXlEb25nTWF1KCkgPyB0aGlzLm1hdWJpbmhUeXBlID0gQ21kLkNvZGUuVFlQRV9NVU9JX0hBSV9DQVlfRE9OR19NQVVcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5pc0JhQ2FpVGh1bmcoKSA/IHRoaXMubWF1YmluaFR5cGUgPSBDbWQuQ29kZS5UWVBFX0JBX0NBSV9USFVOR1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5pc0JhQ2FpU2FuaCgpID8gdGhpcy5tYXViaW5oVHlwZSA9IENtZC5Db2RlLlRZUEVfQkFfQ0FJX1NBTkhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmlzTHVjUGhlQm9uKCkgPyB0aGlzLm1hdWJpbmhUeXBlID0gQ21kLkNvZGUuVFlQRV9MVUNfUEhFX0JPTlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmlzQmluaEx1bmcoaXNUaW5oQWNlKSA/IHRoaXMubWF1YmluaFR5cGUgPSBDbWQuQ29kZS5UWVBFX0JJTkhfTFVOR1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5tYXViaW5oVHlwZSA9IENtZC5Db2RlLlRZUEVfQklOSF9USFVPTkdcblxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGNhcmRUeXBlOiB0aGlzLm1hdWJpbmhUeXBlLFxuICAgICAgICAgICAgICAgIGNoaURhdToga2luZF8wMSxcbiAgICAgICAgICAgICAgICBjaGlHaXVhOiBraW5kXzAyLFxuICAgICAgICAgICAgICAgIGNoaUN1b2k6IGtpbmRfMDNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGFkZENhcmRUb0NoaURhdShhKSB7XG4gICAgICAgICAgICB0aGlzLmNoaURhdS5hZGRDYXJkKGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgYWRkQ2FyZFRvQ2hpR2l1YShhKSB7XG4gICAgICAgICAgICB0aGlzLmNoaUdpdWEuYWRkQ2FyZChhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFkZENhcmRUb0NoaUN1b2koYSkge1xuICAgICAgICAgICAgdGhpcy5jaGlDdW9pLmFkZENhcmQoYSk7XG4gICAgICAgIH1cblxuICAgICAgICBnZXRDaGkoYSkge1xuICAgICAgICAgICAgc3dpdGNoIChhKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlEYXU7XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlHaXVhO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpQ3VvaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGdldEdyb3VwQ2FyZENvbnRhaW5zSW5kZXgoYSkge1xuICAgICAgICAgICAgcmV0dXJuIDAgPD0gYSAmJiA1ID4gYSA/IHRoaXMuY2hpRGF1IDogMTAgPiBhID8gdGhpcy5jaGlHaXVhIDogMTMgPiBhID8gdGhpcy5jaGlDdW9pIDogbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgZ2V0QWxsQ2FyZHMoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IFtdLFxuICAgICAgICAgICAgICAgIGEgPSBhLmNvbmNhdCh0aGlzLmNoaURhdS5jYXJkTGlzdCksXG4gICAgICAgICAgICAgICAgYSA9IGEuY29uY2F0KHRoaXMuY2hpR2l1YS5jYXJkTGlzdCk7XG4gICAgICAgICAgICByZXR1cm4gYSA9IGEuY29uY2F0KHRoaXMuY2hpQ3VvaS5jYXJkTGlzdClcbiAgICAgICAgfVxuXG4gICAgICAgIHN3YXBDYXJkKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgICB2YXIgYyA9IGEuaWQ7XG4gICAgICAgICAgICBhLmlkID0gYi5pZDtcbiAgICAgICAgICAgIGIuaWQgPSBjO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHlwZXNcbiAgICAgICAgaXNTYW5oUm9uZygpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmdldFNvcnRlZENhcmRMaXN0RnJvbUxpc3QodGhpcy5nZXRBbGxDYXJkcygpKSwgYiA9IDAsIGMgPSAxLCBkID0gMDsgZCA8IGEubGVuZ3RoOyBkKyspIGMrKywgYVtkXS5nZXROdW1iZXIoKSA9PSBjICYmIGIrKztcbiAgICAgICAgICAgIHJldHVybiAxMyA9PSBiXG4gICAgICAgIH1cblxuICAgICAgICBpc011b2lCYUNheURvbmdNYXUoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5nZXRBbGxDYXJkcygpLCBiID0gMCwgYyA9IDAsIGQgPSAwOyBkIDwgYS5sZW5ndGg7IGQrKykgYVtkXS5nZXRDb2xvcigpID09IENtZC5Db2RlLkJMQUNLID8gYisrIDogYysrO1xuICAgICAgICAgICAgcmV0dXJuIDEzID09IGIgfHwgMTMgPT0gY1xuICAgICAgICB9XG5cbiAgICAgICAgaXNNdW9pSGFpQ2F5RG9uZ01hdSgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmdldEFsbENhcmRzKCksIGIgPSAwLCBjID0gMCwgZCA9IDA7IGQgPCBhLmxlbmd0aDsgZCsrKSBhW2RdLmdldENvbG9yKCkgPT0gQ21kLkNvZGUuQkxBQ0sgPyBiKysgOiBjKys7XG4gICAgICAgICAgICByZXR1cm4gMTIgPT0gYiB8fCAxMiA9PSBjXG4gICAgICAgIH1cblxuICAgICAgICBpc0JhQ2FpVGh1bmcoKSB7XG4gICAgICAgICAgICBpZiAoISh0aGlzLmNoaURhdS5ncm91cEtpbmQgIT0gQ21kLkNvZGUuR1JPVVBfVEhVTkdfUEhBX1NBTkggJiYgdGhpcy5jaGlEYXUuZ3JvdXBLaW5kICE9IENtZC5Db2RlLkdST1VQX1RIVU5HIHx8IHRoaXMuY2hpR2l1YS5ncm91cEtpbmQgIT0gQ21kLkNvZGUuR1JPVVBfVEhVTkdfUEhBX1NBTkggJiYgdGhpcy5jaGlHaXVhLmdyb3VwS2luZCAhPSBDbWQuQ29kZS5HUk9VUF9USFVORykpIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpQ3VvaS5jYXJkTGlzdDtcbiAgICAgICAgICAgICAgICBpZiAoYVswXS5nZXRTdWl0KCkgPT0gYVsxXS5nZXRTdWl0KCkgJiYgYVsxXS5nZXRTdWl0KCkgPT0gYVsyXS5nZXRTdWl0KCkpIHJldHVybiAhMFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICExXG4gICAgICAgIH1cblxuICAgICAgICBpc0JhQ2FpU2FuaCgpIHtcbiAgICAgICAgICAgIGlmICghKHRoaXMuY2hpRGF1Lmdyb3VwS2luZCAhPSBDbWQuQ29kZS5HUk9VUF9USFVOR19QSEFfU0FOSCAmJiB0aGlzLmNoaURhdS5ncm91cEtpbmQgIT0gQ21kLkNvZGUuR1JPVVBfU0FOSCB8fCB0aGlzLmNoaUdpdWEuZ3JvdXBLaW5kICE9IENtZC5Db2RlLkdST1VQX1RIVU5HX1BIQV9TQU5IICYmIHRoaXMuY2hpR2l1YS5ncm91cEtpbmQgIT0gQ21kLkNvZGUuR1JPVVBfU0FOSCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuZ2V0U29ydGVkQ2FyZExpc3RGcm9tTGlzdCh0aGlzLmNoaUN1b2kuY2FyZExpc3QpO1xuICAgICAgICAgICAgICAgIGlmIChhWzBdLmdldE51bWJlcigpICsgMSA9PSBhWzFdLmdldE51bWJlcigpICYmIGFbMV0uZ2V0TnVtYmVyKCkgKyAxID09IGFbMl0uZ2V0TnVtYmVyKCkgfHwgMiA9PSBhWzBdLmdldE51bWJlcigpICYmXG4gICAgICAgICAgICAgICAgICAgIDMgPT0gYVsxXS5nZXROdW1iZXIoKSAmJiAxNCA9PSBhWzJdLmdldE51bWJlcigpKSByZXR1cm4gITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhMVxuICAgICAgICB9XG5cbiAgICAgICAgaGF2ZVNhdURvaSgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmdldFNvcnRlZENhcmRMaXN0RnJvbUxpc3QodGhpcy5nZXRBbGxDYXJkcygpKSwgYiA9IDAsIGMgPSAwOyBjIDwgYS5sZW5ndGg7KSBjICsgMSA8IGEubGVuZ3RoICYmIGFbYyArIDFdLmdldE51bWJlcigpID09IGFbY10uZ2V0TnVtYmVyKCkgJiYgKGIrKywgYysrKSwgYysrO1xuICAgICAgICAgICAgcmV0dXJuIDYgPT0gYlxuICAgICAgICB9XG5cbiAgICAgICAgaXNMdWNQaGVCb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYXZlU2F1RG9pKCkgJiYgdGhpcy5jaGlEYXUuZ3JvdXBLaW5kID09IENtZC5Db2RlLkdST1VQX1RIVSAmJiB0aGlzLmNoaUdpdWEuZ3JvdXBLaW5kID09IENtZC5Db2RlLkdST1VQX1RIVSAmJiB0aGlzLmNoaUN1b2kuZ3JvdXBLaW5kID09IENtZC5Db2RlLkdST1VQX01PVF9ET0kgPyAhMCA6ICExXG4gICAgICAgIH1cblxuICAgICAgICBpc0JpbmhMdW5nKGEpIHtcbiAgICAgICAgICAgIHJldHVybiAwID4gdGhpcy5jb21wYXJlQ2hpKHRoaXMuY2hpRGF1LCB0aGlzLmNoaUdpdWEsIGEpIHx8IDAgPiB0aGlzLmNvbXBhcmVDaGkodGhpcy5jaGlHaXVhLCB0aGlzLmNoaUN1b2ksIGEpID8gITAgOiAhMVxuICAgICAgICB9XG5cbiAgICAgICAgZ2V0U29ydGVkQ2FyZExpc3RGcm9tTGlzdChhKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBiID0gW10sIGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykgYi5wdXNoKGFbY10pO1xuICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGIubGVuZ3RoIC0gMTsgYysrKVxuICAgICAgICAgICAgICAgIGZvciAoYSA9IGMgKyAxOyBhIDwgYi5sZW5ndGg7IGErKylcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJbY10uZ2V0SWQoKSA+IGJbYV0uZ2V0SWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBiW2NdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYltjXSA9IGJbYV07XG4gICAgICAgICAgICAgICAgICAgICAgICBiW2FdID0gZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYlxuICAgICAgICB9XG5cbiAgICAgICAgY29tcGFyZUNoaShhOiBhbnksIGI6IGFueSwgYzogYW55KSB7XG4gICAgICAgICAgICBpZiAoYS5ncm91cEtpbmQgPiBiLmdyb3VwS2luZCkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYgKGEuZ3JvdXBLaW5kIDwgYi5ncm91cEtpbmQpIHJldHVybiAxO1xuICAgICAgICAgICAgaWYgKGMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZ2V0R3JvdXBLaW5kTGV2ZWwoYyk7XG4gICAgICAgICAgICAgICAgYyA9IGIuZ2V0R3JvdXBLaW5kTGV2ZWwoYyk7XG4gICAgICAgICAgICAgICAgaWYgKGQgPiBjKSByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgaWYgKGQgPCBjKSByZXR1cm4gMVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGEudmFsdWVMaXN0Lmxlbmd0aDsgZCsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGEudmFsdWVMaXN0W2RdID4gYi52YWx1ZUxpc3RbZF0pIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIGlmIChhLnZhbHVlTGlzdFtkXSA8IGIudmFsdWVMaXN0W2RdKSByZXR1cm4gLTFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAwXG4gICAgICAgIH1cblxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbWF1YmluaC5EZXRlY3RQbGF5ZXJDYXJkcztcblxuIl19