{"version":3,"sources":["assets\\Lobby\\LobbyScript\\UIPopupDiemDanh.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAgD;AAChD,mDAAkD;AAClD,+CAA0C;AAC1C,yCAA8B;AAC9B,2CAAsC;AACtC,uEAAkE;AAClE,iDAA4C;AAE5C,iFAA4E;AAC5E,uEAA0D;AAGpD,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA6C,mCAAM;IAAnD;QAAA,qEAiFC;QA/EG,aAAO,GAAY,IAAI,CAAC;QAExB,YAAM,GAAY,IAAI,CAAC;QAEvB,sBAAgB,GAAY,IAAI,CAAC;QAEjC,kBAAY,GAAY,IAAI,CAAC;;IAyEjC,CAAC;IAxEG,+BAAK,GAAL;QAAA,iBAqCC;QAnCG,+BAAqB,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC,UAAC,IAAI;YACjD,IAAI,CAAC,KAAI,CAAC,IAAI,CAAC,MAAM;gBAAE,OAAO;YAC9B,IAAI,QAAQ,GAAG,IAAI,0BAAQ,CAAC,IAAI,CAAC,CAAC;YAClC,iCAAiC;YACjC,QAAQ,QAAQ,CAAC,QAAQ,EAAE,EAAE;gBACzB,KAAK,mBAAG,CAAC,IAAI,CAAC,cAAc;oBAAE;wBAE1B,KAAI,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC;wBACjC,KAAI,CAAC,YAAY,GAAG,IAAI,CAAC;wBACzB,IAAI,GAAG,GAAG,IAAI,mBAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;wBACxC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;wBAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAClC,IAAI,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC;4BACvC,IAAI,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC;4BAC3B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;4BACzD,gDAAgD;4BAChD,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;yBACrD;qBAEJ;oBACG,MAAM;gBACV,KAAK,mBAAG,CAAC,IAAI,CAAC,kBAAkB;oBAAE;wBAC9B,IAAI,GAAG,GAAG,IAAI,mBAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;wBAC5C,gDAAgD;wBAChD,IAAI,GAAG,CAAC,SAAS,EAAE;4BACf,aAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,aAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC,CAAC;4BACnF,+BAAqB,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,IAAI,mBAAG,CAAC,eAAe,EAAE,CAAC,CAAC;4BACpE,iBAAO,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC;4BACtC,2BAAiB,CAAC,IAAI,CAAC,2BAAiB,CAAC,gBAAgB,CAAC,CAAC;yBAC9D;qBACJ;oBACG,MAAM;aACb;QACL,CAAC,EAAE,IAAI,CAAC,CAAC;IAEb,CAAC;IACD,kCAAQ,GAAR;QACI,IAAI,CAAC,aAAa,EAAE,CAAC;IACzB,CAAC;IACD,uCAAa,GAAb;QAAA,iBAqBC;QApBG,cAAI,CAAC,GAAG,CAAC,iBAAO,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,iBAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,EAAE,iBAAO,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,EAAE,SAAS,EAAE,EAAE,UAAC,GAAG,EAAE,GAAG;YACxH,8BAA8B;YAC9B,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,IAAI,EAAE;gBACrB,IAAI,KAAI,CAAC,YAAY,IAAI,IAAI,EAAE;oBAC3B,KAAI,CAAC,YAAY,GAAG,EAAE,CAAC,WAAW,CAAC,KAAI,CAAC,gBAAgB,CAAC,CAAC;oBAC1D,KAAI,CAAC,YAAY,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC;oBACxC,KAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;oBACrC,6BAA6B;iBAChC;gBACD,IAAI,QAAQ,GAAG,CAAC,CAAC;gBACjB,IAAI,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC;gBAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACrC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE;wBAChC,QAAQ,EAAE,CAAA;qBACb;iBACJ;gBACD,EAAE,CAAC,IAAI,CAAC,qBAAqB,EAAE,KAAI,CAAC,YAAY,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,SAAS,GAAG,QAAQ,GAAG,CAAC,CAAC;gBACnG,KAAI,CAAC,YAAY,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,aAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,cAAc,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;aAC5K;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IACD,2CAAiB,GAAjB;QACI,eAAM,CAAC,eAAe,CAAC,YAAY,EAAE,CAAC;QACtC,IAAI,CAAC,OAAO,EAAE,CAAC;IACnB,CAAC;IACD,8BAAI,GAAJ;QACI,iBAAM,IAAI,WAAE,CAAC;QACb,kCAAkC;QAClC,+BAAqB,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,IAAI,mBAAG,CAAC,eAAe,EAAE,CAAC,CAAC;IACxE,CAAC;IA9ED;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;oDACM;IAExB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;mDACK;IAEvB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;6DACe;IAEjC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yDACW;IARZ,eAAe;QADnC,OAAO;OACa,eAAe,CAiFnC;IAAD,sBAAC;CAjFD,AAiFC,CAjF4C,gBAAM,GAiFlD;kBAjFoB,eAAe","file":"","sourceRoot":"/","sourcesContent":["import Configs from \"../../Loading/src/Configs\";\nimport { Global } from \"../../Loading/src/Global\";\nimport Http from \"../../Loading/src/Http\";\nimport cmd from \"./Lobby.Cmd\";\nimport App from \"./Script/common/App\";\nimport BroadcastReceiver from \"./Script/common/BroadcastReceiver\";\nimport Dialog from \"./Script/common/Dialog\";\nimport Utils from \"./Script/common/Utils\";\nimport MiniGameNetworkClient from \"./Script/networks/MiniGameNetworkClient\";\nimport InPacket from \"./Script/networks/Network.InPacket\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class UIPopupDiemDanh extends Dialog {\n    @property(cc.Node)\n    content: cc.Node = null;\n    @property(cc.Node)\n    prefab: cc.Node = null;\n    @property(cc.Node)\n    itemDiemDanhNode: cc.Node = null;\n    @property(cc.Node)\n    itemDiemDanh: cc.Node = null;\n    start() {\n\n        MiniGameNetworkClient.getInstance().addListener((data) => {\n            if (!this.node.active) return;\n            let inpacket = new InPacket(data);\n            //Utils.Log(inpacket.getCmdId());\n            switch (inpacket.getCmdId()) {\n                case cmd.Code.GET_LIST_QUEST: {\n\n                    this.content.removeAllChildren();\n                    this.itemDiemDanh = null;\n                    let res = new cmd.ResGetListQuest(data);\n                    var list = JSON.parse(res.bf);\n                    for (var i = 0; i < list.length; i++) {\n                        var item = cc.instantiate(this.prefab);\n                        item.parent = this.content;\n                        item.setSiblingIndex(list[i].dailyQuestData.piority + 1);\n                        //Utils.Log(list[i].dailyQuestData.piority + 1);\n                        item.getComponent(\"UIItemDiemDanh\").init(list[i]);\n                    }\n\n                }\n                    break;\n                case cmd.Code.RECEIVE_LIST_QUEST: {\n                    let res = new cmd.ResReceiveListQuest(data);\n                    //Utils.Log(\"ListQuest:\" + JSON.stringify(res));\n                    if (res.isSuccess) {\n                        App.instance.alertDialog.showMsg(App.instance.getTextLang('txt_giftcode_success'));\n                        MiniGameNetworkClient.getInstance().send(new cmd.ReqGetListQuest());\n                        Configs.Login.Coin = res.currentMoney;\n                        BroadcastReceiver.send(BroadcastReceiver.USER_UPDATE_COIN);\n                    }\n                }\n                    break;\n            }\n        }, this);\n\n    }\n    onEnable() {\n        this.checkDiemDanh();\n    }\n    checkDiemDanh() {\n        Http.get(Configs.App.API, { c: \"2031\", nn: Configs.Login.Nickname, at: Configs.Login.AccessToken, ac: \"history\" }, (err, res) => {\n            //Utils.Log(\"DIEMDANH:\", res);\n            if (res['data'] != null) {\n                if (this.itemDiemDanh == null) {\n                    this.itemDiemDanh = cc.instantiate(this.itemDiemDanhNode);\n                    this.itemDiemDanh.parent = this.content;\n                    this.itemDiemDanh.setSiblingIndex(0);\n                    //  cc.log(\"init diem danh\");\n                }\n                let progress = 0;\n                let dataHis = res['data'];\n                for (let i = 0; i < dataHis.length; i++) {\n                    if (dataHis[i]['consecutive'] != 0) {\n                        progress++\n                    }\n                }\n                cc.find('BgProgress/Progress', this.itemDiemDanh).getComponent(cc.Sprite).fillRange = progress / 7;\n                this.itemDiemDanh.getChildByName('TxtProgress').getComponent(cc.Label).string = App.instance.getTextLang('txt_progress') + \": \" + Math.floor((progress / 7) * 100) + \"%\";\n            }\n        });\n    }\n    onClickAttendance() {\n        Global.LobbyController.actDiemDanh1();\n        this.dismiss();\n    }\n    show() {\n        super.show();\n        // App.instance.showLoading(true);\n        MiniGameNetworkClient.getInstance().send(new cmd.ReqGetListQuest());\n    }\n}\n"]}