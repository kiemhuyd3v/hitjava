{"version":3,"sources":["assets\\Lobby\\LobbyScript\\Lobby.PopupRefund.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Configs from \"../../Loading/src/Configs\";\nimport Http from \"../../Loading/src/Http\";\nimport App from \"./Script/common/App\";\nimport BroadcastReceiver from \"./Script/common/BroadcastReceiver\";\nimport Dialog from \"./Script/common/Dialog\";\nimport Utils from \"./Script/common/Utils\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport class PopupRefund extends Dialog {\n    @property(cc.Label)\n    lblBalance: cc.Label = null;\n    @property(cc.EditBox)\n    edbCoin: cc.EditBox = null;\n    @property([cc.Node])\n    listItem: cc.Node[] = [];\n    @property([cc.Font])\n    fonts: cc.Font[] = [];\n    @property(Dialog)\n    popupConfirm: Dialog = null;\n\n    @property(cc.Label)\n    lbSport: cc.Label = null;\n    @property(cc.Label)\n    lbCasino: cc.Label = null;\n    @property(cc.Label)\n    lbGameLot: cc.Label = null;\n    @property(cc.Label)\n    lbTotal: cc.Label = null;\n    @property(cc.Label)\n    lbInfomation: cc.Label = null;\n    @property(cc.Button)\n    btnConfirm: cc.Button = null;\n\n    currentItemRefund = null;\n    onLoad() {\n      \n    }\n    onEnable(){\n        this.setInfo();\n    }\n    start() {\n       \n    }\n    setInfo() {\n        let today = new Date().getTime();\n         //Utils.Log(\"today==\" + today);\n        let firstDayRefund = today - 86400 * 1000 * 8;\n        let firstDay = new Date(firstDayRefund).getDate();\n        for (let i = 0; i < 7; i++) {\n            let item = this.listItem[i];\n            let dayRefund = new Date(today - (86400 * 1000 * (7 - i)));\n            let date = dayRefund.getDate();\n            let month = dayRefund.getMonth() + 1;\n            let year = dayRefund.getFullYear();\n            item.getChildByName('lbDay').getComponent(cc.Label).string = cc.js.formatStr(\"%s/%s/%s\", (date < 10 ? \"0\" + date : date), (month < 10 ? \"0\" + month : month), year);\n            item.getComponent(cc.Button).clickEvents[0].customEventData = cc.js.formatStr(\"%s-%s-%s\", year, (month < 10 ? \"0\" + month : month), (date < 10 ? \"0\" + date : date));\n            App.instance.showLoading(true);\n            Http.get(Configs.App.API, { c: \"2029\", nn: Configs.Login.Nickname, at: Configs.Login.AccessToken, date: item.getComponent(cc.Button).clickEvents[0].customEventData }, (err, res) => {\n                 //Utils.Log(res);\n                App.instance.showLoading(false);\n                let lbChip = item.getChildByName('lbChip').getComponent(cc.Label);\n                if (res[\"success\"]) {\n                    let totalRefund = res['data']['sumCasino'] + res['data']['sumGame'] + res['data']['sumSport'];\n                    lbChip.string = \"\";\n                    lbChip.font = this.fonts[0];\n                    lbChip.string = Utils.formatNumber(totalRefund);\n                    lbChip.fontSize = 40;\n                    lbChip.node.y = -101.237;\n                    item.getComponentInChildren(cc.Sprite).node.color = cc.Color.WHITE;\n                    item.getComponent(cc.Button).interactable = true;\n                    item['data'] = res['data'];\n                    item['data']['total'] = totalRefund;\n                    item['data']['date'] = cc.js.formatStr(\"%s-%s-%s\", (date < 10 ? \"0\" + date : date), (month < 10 ? \"0\" + month : month), year);//cái này để show ra cho dễ nhìn\n                    item['data']['dateRefund'] = cc.js.formatStr(\"%s-%s-%s\", year, (month < 10 ? \"0\" + month : month), (date < 10 ? \"0\" + date : date)); //cái này để gưi lên cho server\n                }\n                else {\n                    lbChip.string = \"\";\n                    lbChip.font = this.fonts[1];\n                    lbChip.node.y = -94;\n                    lbChip.fontSize = 20;\n                    item.getComponentInChildren(cc.Sprite).node.color = cc.Color.GRAY;\n                    item.getComponent(cc.Button).interactable = false;\n                    if (res['errorCode'] == 1002) {\n                        lbChip.string = App.instance.getTextLang('txt_refund_receive');\n                    }\n                    else {\n                        lbChip.string = App.instance.getTextLang('txt_refund_error');\n                    }\n\n                }\n            }\n            );\n        }\n    }\n    onClickReceive(even, data) {\n        let dataItem = even.target['data'];\n        this.currentItemRefund = even.target;\n        this.popupConfirm.show();\n        this.lbCasino.string = Utils.formatNumber(dataItem['sumCasino']);\n        this.lbSport.string = Utils.formatNumber(dataItem['sumSport']);\n        this.lbGameLot.string = Utils.formatNumber(dataItem['sumGame']);\n        this.lbTotal.string = Utils.formatNumber(dataItem['total']);\n        this.lbInfomation.string = App.instance.getTextLang('txt_refund_confirm') + \"\\n\" + dataItem['date'];\n        this.btnConfirm.clickEvents[0].customEventData = dataItem['dateRefund'];\n    }\n    onClickConfirm(even, data) {\n        this.popupConfirm.dismiss();\n        App.instance.showLoading(true);\n        Http.get(Configs.App.API, { c: \"2030\", nn: Configs.Login.Nickname, at: Configs.Login.AccessToken, date: data }, (err, res) => {\n             //Utils.Log(res);\n            App.instance.showLoading(false);\n            if (res[\"success\"]) {\n                App.instance.ShowAlertDialog(App.instance.getTextLang('txt_refund_success'));\n                Configs.Login.Coin += this.currentItemRefund['data']['total'];\n                BroadcastReceiver.send(BroadcastReceiver.USER_UPDATE_COIN);\n                let lbChip = this.currentItemRefund.getChildByName('lbChip').getComponent(cc.Label);\n                this.currentItemRefund.getComponent(cc.Button).interactable = false;\n                this.currentItemRefund.getComponentInChildren(cc.Sprite).node.color = cc.Color.GRAY;\n                lbChip.font = this.fonts[1];\n                lbChip.node.y = -94;\n                lbChip.fontSize = 20;\n                lbChip.string = App.instance.getTextLang('txt_refund_receive');\n\n            }\n            else {\n                App.instance.ShowAlertDialog(res.data);\n            }\n        }\n        );\n    }\n}\n"]}