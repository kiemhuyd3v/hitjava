{"version":3,"sources":["assets\\Loading\\src\\HotUpdate.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n@ccclass\nexport default class HotUpdate extends cc.Component {\n\n    // @property(cc.Asset)\n    // manifestUrl: cc.Asset = null;\n\n    @property({\n        type: cc.Asset,\n    })\n    manifestUrl = null;\n\n    @property(cc.Node)\n    loadingNode: cc.Node = null;\n\n    @property([cc.SpriteFrame])\n    bgSplash: cc.SpriteFrame[] = [];\n\n    @property(cc.Sprite)\n    loadingBar: cc.Sprite = null;\n\n    @property([cc.SpriteFrame])\n    listSprBg: cc.SpriteFrame[] = [];\n\n    @property(cc.Label)\n    lb_Info: cc.Label = null;\n    _updating: Boolean = false;\n    _failCount = 0;\n    _canRetry: Boolean = false;\n    _storagePath: string = '';\n    _updateListener = null;\n    _am = null;\n    _checkListener = null;\n    versionCompareHandle = null;\n    gameSceneName = \"main\";\n    loadingGameComp: any = null;\n\n\n\n\n\n    checkCb(event) {\n        //  cc.log('Code CheckCb: ' + event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.loadGame();\n                //  cc.log(\"No local manifest!\");\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                //  cc.log(\"Error Parse/Download manifest!\");\n                this.loadGame();\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                //  cc.log(\"Up To Date!\");\n                this.loadGame();\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this.lb_Info.node.active = true;\n                this.lb_Info.string = \"Đang tải bản cập nhật...\"\n                //  cc.log(\"new version found\");\n                this.loadingBar.fillRange = 0;\n                this.hotUpdate();\n\n                break;\n            default:\n                //  cc.log('Code: ' + event.getEventCode());\n                return;\n        }\n\n        this._am.setEventCallback(null);\n        //  cc.log(\"CheckCB:setEventCallback=null\");\n        this._checkListener = null;\n        this._updating = false;\n    }\n    updateCb(event) {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                //  cc.log(\"============Update CB===============ERROR_NO_LOCAL_MANIFEST\")\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                var msg = event.getMessage();\n                //  cc.log(\"UPDATE_PROGRESSION:\", JSON.stringify(msg));\n                if (msg) {\n                    //  cc.log(\"Progress\" + event.getPercent() / 100 + '% : ' + msg);\n                }\n                this.lb_Info.string = \"Updating: \" + Math.floor(event.getPercent() * 100) + '%';\n                this.loadingBar.fillRange = event.getPercent();\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                //  cc.log(\"============Update CB===============ERROR_PARSE_MANIFEST,ERROR_DOWNLOAD_MANIFEST\")\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                //  cc.log(\"============Update CB===============ALREADY_UP_TO_DATE\")\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                //  cc.log(\"============Update CB===============UPDATE_FINISHED\")\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                //  cc.log(\"============Update CB===============UPDATE_FAILED\")\n                this._am.downloadFailedAssets();\n                this._updating = false;\n                this._canRetry = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                //  cc.log(\"============Update CB===============UPDATE_FAILED\" + \"Asset update error:\" + event.getAssetId() + ', ' + event.getMessage());\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                //  cc.log(\"============Update CB===============ERROR_DECOMPRESS\");\n                break;\n            default:\n                //  cc.log('Code: ' + event.getEventCode());\n                //  cc.log(\"============Update CB===============default hotupdate \");\n                break;\n        }\n\n        if (failed) {\n            //  cc.log(\"Update Failed\");\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n            this._updating = false;\n            this.loadGame();\n\n        }\n\n        if (needRestart) {\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n            // Prepend the manifest's search path\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            //  cc.log(\"newPaths==\" + JSON.stringify(newPaths));\n            //  cc.log(\"searchPaths==\" + JSON.stringify(searchPaths));\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n            cc.audioEngine.stopAll();\n            cc.game.restart();\n        }\n\n    }\n    checkUpdate() {\n        //  cc.log(\"Chay vao hot update\");\n        if (this._updating) {\n            this.lb_Info.string = 'Checking or updating ...';\n            return;\n        }\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            // Resolve md5 url\n            var url = this.manifestUrl.nativeUrl;\n            if (cc.loader.md5Pipe) {\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            this._am.loadLocalManifest(url);\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            //this.panel.info.string = 'Failed to load local manifest ...';\n            return;\n        }\n        this._am.setEventCallback(this.checkCb.bind(this));\n        // cc.log(\"Check Update\");\n        this._am.checkUpdate();\n        this._updating = true;\n    }\n    hotUpdate() {\n        if (this._am && !this._updating) {\n            //  cc.log(\"setEventCallback updateCB\");\n            this._am.setEventCallback(this.updateCb.bind(this));\n\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n                // Resolve md5 url\n                var url = this.manifestUrl.nativeUrl;\n                if (cc.loader.md5Pipe) {\n                    url = cc.loader.md5Pipe.transformURL(url);\n                }\n                this._am.loadLocalManifest(url);\n            }\n\n            this._failCount = 0;\n            this._am.update();\n            //  cc.log(\"HotUpdate deee\");\n            this._updating = true;\n        }\n        else {\n            var _this = this;\n            this.scheduleOnce(function () {\n                _this.hotUpdate();\n            }, 0.5)\n        }\n    }\n    onLoad() {\n        this.loadingGameComp = this.loadingNode.getComponent(\"Loading\");\n        // Hot update is only available in Native build\n        if (!cc.sys.isNative && cc.sys.isBrowser || cc.sys.os === cc.sys.OS_OSX) {\n            this.loadGame();\n            return;\n        }\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'lote88-remote-asset');\n        //  cc.log('Storage path for remote asset : ' + this._storagePath);\n        // Setup your own version compare handler, versionA and B is versions in string\n        // if the return value greater than 0, versionA is greater than B,\n        // if the return value equals 0, versionA equals to B,\n        // if the return value smaller than 0, versionA is smaller than B.\n        this.versionCompareHandle = function (versionA, versionB) {\n            // cc.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        // Init with empty manifest url for testing custom manifest\n        this._am = new jsb.AssetsManager('', this._storagePath, this.versionCompareHandle);\n\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\n        // Return true if the verification passed, otherwise return false\n        this._am.setVerifyCallback(function (path, asset) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n            if (compressed) {\n                //  cc.log(\"Verification passed : \" + relativePath);\n                return true;\n            }\n            else {\n                //  cc.log(\"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')');\n                return true;\n            }\n        });\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            // Some Android device may slow down the download process when concurrent tasks is too much.\n            // The value may not be accurate, please do more test and find what's most suitable for your game.\n            this._am.setMaxConcurrentTask(10);\n        }\n        this.checkUpdate();\n\n    }\n    start() {\n        // Utils.getGetDeviceId();\n        if (cc.sys.isBrowser) {\n\n            // Global.loadTextConfig();\n            // LoadConfig.getInstance().pushDataEco();\n        }\n\n    }\n    loadGame() {\n        this.loadingGameComp.startGame();\n\n    }\n\n    onDestroy() {\n        if (this._updateListener) {\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n        }\n    }\n    // update (dt) {}\n}\n"]}