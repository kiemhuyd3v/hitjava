{"version":3,"sources":["assets\\Lieng\\LiengScript\\Lieng.NetworkClient.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,qDAAgD;AAEhD,uGAA0F;AAC1F,2GAA8F;AAG9F;IAAgD,sCAAa;IAYzD;QAAA,YACI,iBAAO,SAEV;QAZO,eAAS,GAA2B,IAAI,KAAK,EAAmB,CAAC;QAWrE,KAAI,CAAC,QAAQ,GAAG,iBAAO,CAAC,GAAG,CAAC,OAAO,CAAC;;IACxC,CAAC;IAVa,8BAAW,GAAzB;QACI,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,EAAE;YACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,kBAAkB,EAAE,CAAC;SAC5C;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAOM,oCAAO,GAAd;QACI,iBAAM,OAAO,YAAC,iBAAO,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,iBAAO,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;IAC5E,CAAC;IAES,mCAAM,GAAhB,UAAiB,EAAS;QACtB,iBAAM,MAAM,YAAC,EAAE,CAAC,CAAC;IACrB,CAAC;IAES,sCAAS,GAAnB,UAAoB,EAAgB;QAChC,IAAI,IAAI,GAAG,IAAI,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC5C,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACjC,IAAI,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM,YAAY,MAAM,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE;gBAC9E,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aAC3B;iBAAM;gBACH,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC5B,CAAC,EAAE,CAAC;aACP;SACJ;IACL,CAAC;IAEM,wCAAW,GAAlB,UAAmB,QAAoC,EAAE,MAAoB;QACzE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,iCAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC;IAC/D,CAAC;IAEM,iCAAI,GAAX,UAAY,MAAiB;QACzB,KAAK,IAAI,CAAC,GAAG,IAAI,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,OAAO,EAAE,CAAC,EAAE;YACtE,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC3B,IAAI,IAAI,CAAC,EAAE,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE;YACrC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IACL,yBAAC;AAAD,CAhDA,AAgDC,CAhD+C,+BAAa,GAgD5D","file":"","sourceRoot":"/","sourcesContent":["import Configs from \"../../Loading/src/Configs\";\r\nimport App from \"../../Lobby/LobbyScript/Script/common/App\";\r\nimport NetworkClient from \"../../Lobby/LobbyScript/Script/networks/Network.NetworkClient\";\r\nimport NetworkListener from \"../../Lobby/LobbyScript/Script/networks/Network.NetworkListener\";\r\nimport OutPacket from \"../../Lobby/LobbyScript/Script/networks/Network.OutPacket\";\r\n\r\nexport default class LiengNetworkClient extends NetworkClient {\r\n    private static instance: LiengNetworkClient;\r\n\r\n    private listeners: Array<NetworkListener> = new Array<NetworkListener>();\r\n\r\n    public static getInstance(): LiengNetworkClient {\r\n        if (this.instance == null) {\r\n            this.instance = new LiengNetworkClient();\r\n        }\r\n        return this.instance;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this.isUseWSS = Configs.App.USE_WSS;\r\n    }\r\n\r\n    public connect() {\r\n        super.connect(Configs.App.HOST_LIENG.host, Configs.App.HOST_LIENG.port);\r\n    }\r\n\r\n    protected onOpen(ev: Event) {\r\n        super.onOpen(ev);\r\n    }\r\n\r\n    protected onMessage(ev: MessageEvent) {\r\n        var data = new Uint8Array(ev.data);\r\n        for (var i = 0; i < this.listeners.length; i++) {\r\n            var listener = this.listeners[i];\r\n            if (listener.target && listener.target instanceof Object && listener.target.node) {\r\n                listener.callback(data);\r\n            } else {\r\n                this.listeners.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n\r\n    public addListener(callback: (data: Uint8Array) => void, target: cc.Component) {\r\n        this.listeners.push(new NetworkListener(target, callback));\r\n    }\r\n\r\n    public send(packet: OutPacket) {\r\n        for (var b = new Int8Array(packet._length), c = 0; c < packet._length; c++)\r\n            b[c] = packet._data[c];\r\n        if (this.ws != null && this.isConnected())\r\n            this.ws.send(b.buffer);\r\n    }\r\n}\r\n"]}