{"version":3,"sources":["assets\\Lobby\\LobbyScript\\Script\\common\\Tween.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Utils from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\nnamespace common {\n\n    export class TweenListener {\n        target: cc.Component = null;\n        duration: number = 0;\n        curDuration: number = 0;\n        callback: (p: number) => void = null;\n    }\n\n    @ccclass\n    export class Tween extends cc.Component {\n\n        private static instance: Tween = null;\n        private static getInstance(): Tween {\n            if (this.instance == null) {\n                let node = new cc.Node();\n                node.name = \"Tween\";\n                cc.game.addPersistRootNode(node);\n                this.instance = node.addComponent(Tween);\n            }\n            return this.instance;\n        }\n\n        private static listeners = new Array<TweenListener>();\n\n        private skeepFrame = false;\n        private readonly countSkeep = 1;\n        private curCountSkeep = 0;\n        private delta = 0;\n\n        update(dt: number) {\n            if (this.skeepFrame) {\n                this.curCountSkeep++;\n                this.delta += dt;\n                if (this.curCountSkeep >= this.countSkeep) {\n                    this.curCountSkeep = 0;\n                    this.skeepFrame = false;\n                }\n                return;\n            }\n            for (var i = 0; i < Tween.listeners.length; i++) {\n                let listener = Tween.listeners[i];\n                if (listener.target && listener.target instanceof cc.Component && listener.target.node) {\n                    listener.curDuration = Math.min(listener.duration, listener.curDuration + dt + this.delta);\n                    listener.callback(listener.curDuration / listener.duration);\n                    if (listener.curDuration >= listener.duration) {\n                        Tween.listeners.splice(i--, 1);\n                    }\n                } else {\n                    Tween.listeners.splice(i--, 1);\n                }\n            }\n\n            this.skeepFrame = true;\n            this.delta = 0;\n        }\n\n        static numberTo(label: cc.Label, toNumber: number, duration: number, format: (n: number) => string = (n) => { return Utils.formatNumber(n) }) {\n            this.getInstance();\n            let listener = null;\n            for (var i = 0; i < Tween.listeners.length; i++) {\n                let _listener = Tween.listeners[i];\n                if (_listener.target == label) {\n                    listener = _listener;\n                    break;\n                }\n            }\n            if (listener == null) {\n                listener = new TweenListener();\n                this.listeners.push(listener);\n            }\n            let startNumber = Utils.stringToInt(label.string);\n            let distance = toNumber - startNumber;\n            listener.curDuration = 0;\n            listener.duration = duration;\n            listener.target = label;\n            listener.callback = (p: number) => {\n                label.string = format(parseInt(\"\" + (startNumber + distance * p)));\n            }\n        }\n\n        public static showPopup(box:cc.Node,parent:cc.Node){\n            parent.active = true;\n            box.scale = 0;\n            parent.opacity = 0;\n            cc.Tween.stopAllByTarget(box);\n            cc.Tween.stopAllByTarget(parent);\n            cc.tween(box)\n                .to(0.5, { scale: 1 }, { easing: \"backOut\" })\n                .start();\n    \n            cc.tween(parent)\n                .to(0.3, { opacity: 255 }, { easing: \"linear\" })\n                .start();\n        }\n    \n        public static hidePopup(box:cc.Node,parent:cc.Node,isDestroy:boolean = true){\n            cc.Tween.stopAllByTarget(box);\n            cc.Tween.stopAllByTarget(parent);\n            cc.tween(box)\n                .to(0.5, { scale: 0 }, { easing: \"backIn\" })\n                .call(() => {\n                    if(isDestroy){\n                        parent.destroy();\n                    }\n                    else{\n                        parent.active =  false;\n                    }\n                })\n                .start();\n    \n            cc.tween(parent)\n                .to(0.5, { opacity: 0 }, { easing: \"linear\" })\n                .start();\n        }\n    }\n\n\n}\nexport default common.Tween;"]}