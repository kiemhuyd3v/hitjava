{"version":3,"sources":["assets\\TaiXiuDouble\\TaiXiuScript\\TaiXiu1\\TaiXiuMini.PanelChat.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import cmd from \"./TaiXiuMini.Cmd\";\nimport TaiXiuMiniController from \"./TaiXiuMini.TaiXiuMiniController\";\nimport Configs from \"../../../Loading/src/Configs\";\nimport MiniGameNetworkClient from \"../../../Lobby/LobbyScript/Script/networks/MiniGameNetworkClient\";\n\nconst { ccclass, property } = cc._decorator;\n\nnamespace taixiumini {\n    @ccclass\n    export class PanelChat extends cc.Component {\n\n        @property(cc.Node)\n        itemChatTemplate: cc.Node = null;\n        @property(cc.ScrollView)\n        scrMessage: cc.ScrollView = null;\n        @property(cc.EditBox)\n        edbMessage: cc.EditBox = null;\n\n        start() {\n            this.itemChatTemplate.active = false;\n            this.edbMessage.node.on(\"editing-return\", ()=>{\n                this.sendChat();\n            });\n            // this.edbMessage.node.on(\"editing-did-ended\", ()=>{\n            //     this.sendChat();\n            // });\n        }\n\n        show(isShow: boolean) {\n            this.node.active = isShow;\n            if (isShow) {\n                // for (var i = 0; i < this.scrMessage.content.childrenCount; i++) {\n                //     let node = this.scrMessage.content.children[i];\n                //     node.active = false;\n                // }\n                MiniGameNetworkClient.getInstance().send(new cmd.SendScribeChat());\n            } else {\n                MiniGameNetworkClient.getInstance().send(new cmd.SendUnScribeChat());\n            }\n        }\n\n        addMessage(nickname: string, message: string) {\n            let item: cc.Node = null;\n            for (var i = 0; i < this.scrMessage.content.childrenCount; i++) {\n                let node = this.scrMessage.content.children[i];\n                if (!node.active) {\n                    item = node;\n                    break;\n                }\n            }\n            if (item == null) {\n                if (this.scrMessage.content.childrenCount >= 50) {\n                    item = this.scrMessage.content.children[0];\n                } else {\n                    item = cc.instantiate(this.itemChatTemplate);\n                }\n            }\n            var zIndex = 0;\n            for (var i = 0; i < this.scrMessage.content.childrenCount; i++) {\n                let node = this.scrMessage.content.children[i];\n                if (node != item) {\n                    node.zIndex = zIndex++;\n                }\n            }\n            item.parent = this.scrMessage.content;\n            let lblNickname: cc.Label = item.getChildByName(\"lblNickname\").getComponent(cc.Label);\n            lblNickname.string = `${nickname}:`;\n            lblNickname.node.color = nickname == Configs.Login.Nickname ? cc.Color.WHITE.fromHEX(\"#3bff49\") : cc.Color.WHITE.fromHEX(\"#f7da38\");\n            item.getComponent(cc.Label).string = `${nickname}: ${message}`;\n            item.active = true;\n            item.zIndex = zIndex++;\n            this.scrollToBottom();\n        }\n\n        sendChat() {\n            let msg = this.edbMessage.string.trim();\n            if (msg.length == 0) {\n                return;\n            }\n            this.edbMessage.string = \"\";\n            TaiXiuMiniController.instance.sendChat(msg);\n        }\n\n        scrollToBottom() {\n            this.scrMessage.scrollToBottom(0.2);\n        }\n    }\n}\nexport default taixiumini.PanelChat;\n"]}