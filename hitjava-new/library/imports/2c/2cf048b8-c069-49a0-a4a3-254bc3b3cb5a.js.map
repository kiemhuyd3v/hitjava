{"version":3,"sources":["assets\\Lobby\\LobbyScript\\Script\\Service\\FaceBook\\FBsrv.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Configs from \"../../../../../Loading/src/Configs\";\nimport App from \"../../common/App\";\nimport SPUtils from \"../../common/SPUtils\";\nimport Utils from \"../../common/Utils\";\nimport facebookSdk from \"./Facebook\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class FBsrv extends cc.Component {\n\n    static inst: FBsrv = null;\n    isLogined: boolean = false;\n    private statusResponse: fb.StatusResponse = null;\n    static appID = '439607153788936';\n    static webVersion = '{api-version}';\n    accessToken: string = null;\n\n    start() {\n        this.init();\n    }\n\n    static getInst() {\n        if (!this.inst) {\n            this.inst = new cc.Node().addComponent(FBsrv);\n        }\n        return this.inst;\n    };\n\n    init() {\n        if (cc.sys.isBrowser) {\n            this._initWeb();\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            this._initAndroid();\n        } else if (cc.sys.os == cc.sys.OS_IOS) {\n            this._initIOS();\n        }\n    };\n\n    _initWeb() {\n        let params: fb.InitParams = {\n            appId: Configs.App.FB_APPID,\n            version: FBsrv.webVersion,\n            status: true,\n            cookie: true,\n            xfbml: true,\n            autoLogAppEvents: false\n        }\n        FB.init(params);\n    };\n\n    isUseSDK()\n    {\n        if (cc.sys.os == cc.sys.OS_ANDROID) return true;\n        if (cc.sys.os == cc.sys.OS_IOS) return true;\n        return false;\n    };\n\n    callLoginToFB(callback)\n    {\n        cc.sys.localStorage.setItem(\"isLoginFB\",1);\n        App.instance.showLoading(true,-1);\n        var self = this;\n        if(self.isUseSDK())\n        {\n            if (sdkbox.PluginFacebook.isLoggedIn()) {\n                Configs.Login.AccessToken = sdkbox.PluginFacebook.getAccessToken();\n                callback();\n            } else {\n                 //Utils.Log(\"FB to Login\");\n                sdkbox.PluginFacebook.login(['public_profile', 'email']);\n            }\n        }\n        else\n        {\n            let Appid = Configs.App.FB_APPID;\n            let scope = 'email,public_profile';\n            if(self.sdk != null)\n            {\n                try{\n                    FB.getLoginStatus((data) => {\n                        if (data.status === 'connected') {\n                            \n                            Configs.Login.AccessToken = data.authResponse.accessToken;\n                            callback();\n\n                        } else if (data.status === 'not_authorized') {\n\n                            App.instance.showErrLoading(\"Lỗi đăng nhập status: \" + data.status);\n                        } else {\n                            FB.login(self.fbRespone, { scope: Scope });\n                        }\n                    });\n                }\n                catch (e)\n                {\n                    App.instance.showLoading(false);\n                    App.instance.showErrLoading(\"Lỗi đăng nhập status: \" + e.message);\n                }\n            }\n            else\n            {\n                self.sdk = new facebookSdk(Appid, scope, self.fbRespone);\n            }\n            \n            \n        }\n    }\n\n    fbRespone(response)\n    {\n        var self = this;\n        if(response.status != \"200\")\n        {\n            if(response.response != \"wait\")\n            {\n                 //Utils.Log(JSON.stringify(response));\n                App.instance.showLoading(false);\n                App.instance.showErrLoading(\"Lỗi đăng nhập status: \" + response.status);\n                \n            }\n            \n        }else\n        {\n            Configs.Login.AccessToken = response.response.authResponse.accessToken;\n            self.loginFB();\n        }\n    },\n\n    _initAndroid() {\n\n    };\n\n    _initIOS() {\n\n    };\n\n    async login(callBack: Function) {\n        if (cc.sys.isBrowser) {\n            await this._loginWeb(callBack);\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            this._loginAndroid(callBack);\n        } else if (cc.sys.os == cc.sys.OS_IOS) {\n            this._loginIOS(callBack);\n        }\n        return this.isLogined;\n    };\n\n    async _loginWeb(callBack: Function) {\n        let _this = this;\n        await new Promise((resolve => {\n            FB.login(function (response) {\n                callBack(response);\n                if (response.status === 'connected') {\n                    _this.isLogined = true;\n                }\n                else{\n                    _this.isLogined = false;\n                }\n                resolve('success');\n            }, { auth_type: \"reauthorize\"});\n        }));\n    };\n\n    _loginAndroid(callBack: Function) {\n\n    };\n\n    _loginIOS(callBack: Function) {\n\n    };\n\n    logout(callBack: Function) {\n        if (cc.sys.isBrowser) {\n            this._logoutWeb(callBack);\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            this._logoutAndroid(callBack);\n        } else if (cc.sys.os == cc.sys.OS_IOS) {\n            this._logoutIOS(callBack);\n        }\n    };\n\n    _logoutWeb(callBack: Function) {\n        FB.logout(function (response) {\n            callBack(response);\n        });\n    };\n\n    _logoutAndroid(callBack: Function) {\n\n    };\n\n    _logoutIOS(callBack: Function) {\n\n    };\n\n    async checkLoginStatus(callBack: Function) {\n        if (cc.sys.isBrowser) {\n            await this._checkLoginStatusWeb(callBack);\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            this._checkLoginStatusAndroid(callBack);\n        } else if (cc.sys.os == cc.sys.OS_IOS) {\n            this._checkLoginStatusIOS(callBack)\n        }\n        return this.isLogined;\n    };\n\n    async _checkLoginStatusWeb(callBack: Function) {\n        let _this = this;\n        await new Promise((resolve => {\n            FB.getLoginStatus(function (response) {\n                callBack(response);\n                if (response.status === 'connected') {\n                    _this.isLogined = true;\n                    SPUtils.setUserAccessTokenFB(response.authResponse.accessToken);\n                }\n                else{\n                    _this.isLogined = false;\n                }\n                resolve('success');\n            });\n        }));\n    }\n\n    _checkLoginStatusAndroid(callBack: Function) {\n\n    }\n\n    _checkLoginStatusIOS(callBack: Function) {\n\n    }\n\n    async getAccessToken() {\n        await this.checkLoginStatus(()=>{});\n        return SPUtils.getUserAccessTokenFB();\n    }\n\n}\n"]}